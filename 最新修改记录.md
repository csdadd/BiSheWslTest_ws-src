# 修改记录

## 问题描述
将实时日志模块的已确定实现特性写入规范文档 `spec.md`，作为后续开发的参考基准。已锁定的模块不再修改核心设计。

特性包括：
- 日志级别定义（DEBUG/INFO/WARNING/ERROR/FATAL/HIGHFREQ/ODOMETRY）
- 日志容器大小（三级缓冲架构）
- 日志数据流（产生→分发→存储）
- 不同级别日志的处理差异
- 批量写入优化
- 特殊级别隔离（HIGHFREQ/ODOMETRY）
- 日志轮转机制
- 数据库表结构

## 修改文件列表
- `renwu/spec.md`: 新建模块规范文档，记录实时日志模块已锁定的实现特性

## 修改详情

### renwu/spec.md
**操作**: 新建文件

```markdown
# Renwu 模块规范文档

> 本文档记录各模块已确定的实现特性，作为后续开发的参考基准。

## 目录
1. [实时日志模块](#1-实时日志模块) *(已锁定)*
2. [预留模块] ← 可扩展区域

## 1. 实时日志模块

**状态**: 已锁定
**锁定日期**: 2026-02-13

### 1.1 日志级别定义
| 级别 | 数值 | 用途 | 显示颜色 |
|------|------|------|----------|
| DEBUG | 0 | 调试信息 | 灰色 |
| INFO | 1 | 常规信息 | 黑色 |
| WARNING | 2 | 警告 | 橙色 |
| ERROR | 3 | 错误 | 红色 |
| FATAL | 4 | 致命错误 | 深红色 |
| HIGHFREQ | 5 | 高频日志 | 蓝色 |
| ODOMETRY | 6 | 里程计数据 | 不显示 |

### 1.2 日志容器大小
| 容器 | 大小限制 |
|------|----------|
| m_allLogs | 10000 条 |
| m_logs (UI) | 1000 条 |
| 批量更新阈值 | 100 条 |
| 数据库批量插入 | 100 条 |

### 1.3 三级缓冲架构
ThreadSafeQueue(无限制) → m_allLogs(10000条) → m_logs(1000条)

### 1.4 日志级别处理差异
| 级别类型 | UI显示 | 写入文件 | 写入数据库 | 批量策略 |
|----------|--------|----------|------------|----------|
| 普通日志 | 是 | 是 | logs表 | 2秒定时 |
| HIGHFREQ | 是 | 否 | high_freq_logs | 4条批量 |
| ODOMETRY | 否 | 否 | odometry_logs | 100条批量 |

### 1.5 日志轮转
- 单文件最大: 10 MB
- 保留文件数: 5 个
- 命名格式: robot_YYYY-MM-DD.log
```

## 解决方案摘要

- **背景**：实时日志模块经过多轮优化（批量写入、多表查询、级别隔离等），已满足需求
- **目的**：将已确定的特性固化成规范文档，防止后续开发中意外修改核心设计
- **文档结构**：
  - 模块化章节设计，每个模块独立编号
  - 预留新模块模板（注释形式），方便扩展
  - 变更记录表追踪后续修改
- **覆盖内容**：
  - 日志级别枚举及颜色
  - 容器大小限制
  - 数据流图
  - 级别处理差异对比表
  - 三级缓冲架构图
  - 批量写入策略
  - 日志轮转参数
  - 数据库表结构及索引

## 文档扩展性设计

后续添加新模块时：
1. 在目录中添加新条目
2. 复制预留模板结构
3. 填写新模块规范
4. 更新变更记录

---
记录时间: 2026-02-13
